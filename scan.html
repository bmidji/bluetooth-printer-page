<script>
  const resultsList = document.getElementById("results-list");
  const scannedCodes = new Set(); // unique scanned codes
  const generateBtn = document.getElementById("generate-btn");
  const generatedQrDiv = document.getElementById("generated-qr");

  function onScanSuccess(decodedText, decodedResult) {
    if (!scannedCodes.has(decodedText)) {
      scannedCodes.add(decodedText);

      const div = document.createElement("div");
      div.className = "code-item";
      div.textContent = decodedText;
      resultsList.appendChild(div);
    }
  }

  const config = {
    fps: 10,
    qrbox: 250,
    rememberLastUsedCamera: true,
    facingMode: { exact: "environment" }
  };

  const html5QrcodeScanner = new Html5QrcodeScanner("reader", config);
  html5QrcodeScanner.render(onScanSuccess);

  generateBtn.addEventListener("click", () => {
    const combined = Array.from(scannedCodes).join("\r");
    QRCode.toDataURL(combined, { width: 300 }, (err, url) => {
      if (err) {
        console.error(err);
        return;
      }
      generatedQrDiv.innerHTML = `<h2>Combined QR Code:</h2><img src="${url}" alt="QR Code">`;
    });
  });

  // ðŸš€ App Inventor integration
  function sendQRDataToApp() {
    const combined = Array.from(scannedCodes).join("\r");
    if (window.AppInventor) {
      window.AppInventor.setWebViewString(combined);
    } else {
      alert("AppInventor bridge not found.");
    }
  }
</script>
